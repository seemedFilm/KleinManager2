{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2>Kleinanzeigen Bot</h2>
    <p>Hier kannst du den Kleinanzeigen-Bot steuern.</p>

    <div class="card shadow-sm p-3">
        <div class="d-flex gap-2">
            <button id="start-btn" class="btn btn-success">Starten</button>
            <button id="stop-btn" class="btn btn-danger">Stoppen</button>
            <button id="status-btn" class="btn btn-primary">Status pr√ºfen</button>
        </div>

        <div id="status-output" class="mt-3 alert alert-secondary">
            Status: <span id="status-text">unbekannt</span>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const statusText = document.getElementById("status-text");
    const output = document.getElementById("status-output");

    async function updateStatus() {
        try {
            const res = await fetch("/bot/status");
            const data = await res.json();
            statusText.textContent = data.status || "Fehler";
            output.className = "mt-3 alert " + (data.status === "running" ? "alert-success" : "alert-warning");
        } catch (e) {
            statusText.textContent = "Fehler beim Abrufen";
            output.className = "mt-3 alert alert-danger";
        }
    }

    document.getElementById("start-btn").addEventListener("click", async () => {
        await fetch("/bot/start", { method: "POST" });
        updateStatus();
    });

    document.getElementById("stop-btn").addEventListener("click", async () => {
        await fetch("/bot/stop", { method: "POST" });
        updateStatus();
    });

    document.getElementById("status-btn").addEventListener("click", updateStatus);

    // initial laden
    updateStatus();
});
</script>
{% endblock %}
